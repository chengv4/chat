import{E as ElIcon,M as ElMessage,_ as _export_sfc}from"./index-DkLl1Mym.js";import{E as ElButton}from"./el-button-C-rinkoZ.js";import{E as ElInput}from"./el-input-BJspUI6P.js";import"./el-popper-BmyoOjKi.js";import{E as ElPopover}from"./el-popover-BKyHDEPi.js";import{_ as _sfc_main$1,E as ElMessageBox,a as _sfc_main$2}from"./el-message-box-HjHDSNt2.js";import{u as useAdminStore}from"./adminModels-CxFvKhCu.js";import{u as useHomeStore}from"./homeModels-OA35pHxQ.js";import{_ as storeToRefs,r as ref,f as computed,a9 as onBeforeMount,M as createBlock,o as openBlock,D as createVNode,V as resolveComponent,I as createTextVNode}from"./vendor-DJ8gqV4u.js";import"./el-overlay-DOY3HgpZ.js";import"./utils-CNKHhdMi.js";import"./index-CCBTS1bG.js";import"./index-BPH8_BdK.js";import"./index-D2oWfImC.js";import"./event-BwRzfsZt.js";import"./index-D5u6ftxn.js";import"./error-D_Dr4eZ1.js";import"./index-BrItYASQ.js";import"./el-select-DtnkVBNM.js";import"./scroll-LLMUe-F0.js";import"./debounce-B3Yv7TkI.js";import"./index-CeMPAXKl.js";import"./el-tooltip-CufEVF1z.js";import"./el-form-item-DLU3uk7d.js";import"./wangeditor-oAbnVgNb.js";import"./url-DjwWyOfx.js";const _sfc_main={__name:"MenusAdmin",setup(__props){const adminStore=useAdminStore(),{menusList:menusList}=storeToRefs(adminStore),{userInfo:userInfo}=storeToRefs(useHomeStore()),formRef=ref(null),formModel=ref({});let copyData=ref([]),inputJson=ref([]);const isAdmin=computed((()=>"admin"===userInfo.value.username));onBeforeMount((()=>{adminStore.getMenus()}));const tableData=computed((()=>({total:0,list:[{id:"0",name:"所有菜单",children:menusList.value.list}]}))),tableColumns=[{prop:"name",label:"菜单名称",align:"center",width:"300",render:({row:e,column:o,index:l})=>createVNode("div",{class:"name-group"},[createVNode("div",{style:"max-width: 120px;white-space: nowrap;overflow: hidden;text-overflow:ellipsis;"},[e.name]),createVNode("span",{class:"icon-group"},[isAdmin.value&&createVNode(ElIcon,{title:"新增子菜单"},{default:()=>[createVNode(resolveComponent("Plus"),{color:"#409eff",onclick:()=>handleEdit(e,"add")},null)]}),"0"===e.id&&isAdmin.value&&createVNode(ElPopover,{placement:"bottom-start",trigger:"click",width:"326"},{reference:()=>createVNode(ElIcon,null,{default:()=>[createVNode(resolveComponent("UploadFilled"),{color:"#409eff"},null)]}),default:()=>createVNode("div",{style:{width:"300px"}},[createVNode(ElInput,{type:"textarea",rows:4,placeholder:"请输入内容数组",modelValue:inputJson.value,"onUpdate:modelValue":e=>inputJson.value=e},null),createVNode(ElButton,{type:"primary",size:"mini",style:{float:"right"},onClick:()=>uploadMenus(e)},{default:()=>[createTextVNode("确认导入")]})])}),"0"!==e.id&&createVNode(ElIcon,{title:"编辑"},{default:()=>[createVNode(resolveComponent("EditPen"),{color:"#409eff",onclick:()=>handleEdit(e,"edit")},null)]}),"0"!==e.id&&isAdmin.value&&createVNode(ElIcon,{onclick:()=>handleCopy(e),title:"复制"},{default:()=>[createVNode(resolveComponent("DocumentCopy"),null,null)]}),0!==copyData.value.length&&isAdmin.value&&createVNode(ElIcon,{onclick:()=>handlePaste(e,copyData.value),title:"粘贴"},{default:()=>[createVNode(resolveComponent("DocumentAdd"),null,null)]}),"0"!==e.id&&isAdmin.value&&createVNode(ElIcon,{title:"删除"},{default:()=>[createVNode(resolveComponent("Delete"),{color:"red",onclick:()=>handleDelete(e)},null)]})])])},{prop:"path",label:"路由地址",align:"center"},{prop:"menuType",label:"菜单类型",align:"center"},{prop:"component",label:"页面组件",align:"center"},{prop:"sortNo",label:"排序",align:"center"}],formItems=[{label:"菜单名称",prop:"name",type:"input",placeholder:"请输入菜单名称",rules:[{required:!0}]},{label:"菜单地址",prop:"path",type:"input",placeholder:"请输入菜单地址",rules:[{required:!0}]},{label:"菜单类型",prop:"menuType",type:"select",rules:[{required:!0}],options:[{label:"首页",value:"0"},{label:"组件",value:"1"},{label:"笔记",value:"3"},{label:"自定义",value:"4"},{label:"系统设置",value:"2"}]},{label:"页面组件",prop:"component",type:"input"},{label:"显示/隐藏",prop:"show",type:"switch"},{label:"排序",prop:"sortNo",type:"InputNumber",step:3}],handleEdit=(e,o)=>{"add"===o&&(formModel.value={pid:e.id,show:!0}),"edit"===o&&(formModel.value={...e}),ElMessageBox({title:"新增/编辑菜单",closeOnClickModal:!1,customClass:"custom-message-box",message:()=>createVNode(_sfc_main$2,{ref:formRef,formModel:formModel,formItems:formItems},null),beforeClose:(e,o,l)=>{if("confirm"===e){if(formRef.value){const e=formRef.value.form,o=formRef.value.formData||{};e.validate((e=>{e&&adminStore.saveRoute(o).then((e=>{0===e.code&&l()}))}))}}else l()}})},handleDelete=e=>{ElMessageBox({message:"确定要删除吗？",type:"warning",title:""}).then((o=>{"confirm"===o&&adminStore.deleteRoute(e)}))},handleCopy=e=>{copyData.value=[{...e}],ElMessage.success("复制成功")},handlePaste=async(e,o)=>{Promise.all(o.map((o=>adminStore.saveRoute({...o,name:`${o.name}_copy`,id:"",pid:e.id},!1).then((e=>({...e,item:o})))))).then((e=>{let o=!1;e.forEach((({data:e,item:l})=>{var t;(null==(t=null==l?void 0:l.children)?void 0:t.length)&&(o=!0,handlePaste({id:e.id,name:`${e.name}_copy`},l.children))})),o||(copyData.value=[],adminStore.getMenus())})).catch((()=>{}))},uploadMenus=row=>{const arr=eval(inputJson.value);(null==arr?void 0:arr.length)&&handlePaste(row,arr)};return(e,o)=>(openBlock(),createBlock(_sfc_main$1,{class:"menus-admin",tableData:tableData.value,tableColumns:tableColumns,showSort:"","default-expand-all":""},null,8,["tableData"]))}},MenusAdmin=_export_sfc(_sfc_main,[["__scopeId","data-v-868ba493"]]);export{MenusAdmin as default};
