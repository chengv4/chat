import{$ as e,B as t,c as n,a as o,n as s,i as a,o as r,w as u}from"./index-D0F4Kqml.js";import{a as d,a6 as c,r as i,d as l,B as f,w as v,u as p,p as m,h as E,z as b,M as y,o as h,ax as w}from"./vendor-BExUNkqn.js";const L=e=>Array.from(e.querySelectorAll('a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])')).filter((e=>T(e)&&(e=>"fixed"!==getComputedStyle(e).position&&null!==e.offsetParent)(e))),T=e=>{if(e.tabIndex>0||0===e.tabIndex&&null!==e.getAttribute("tabIndex"))return!0;if(e.tabIndex<0||e.hasAttribute("disabled")||"true"===e.getAttribute("aria-disabled"))return!1;switch(e.nodeName){case"A":return!!e.href&&"ignore"!==e.rel;case"INPUT":return!("hidden"===e.type||"file"===e.type);case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},g=function(e,t,...n){let o;o=t.includes("mouse")||t.includes("click")?"MouseEvents":t.includes("key")?"KeyboardEvent":"HTMLEvents";const s=document.createEvent(o);return s.initEvent(t,...n),e.dispatchEvent(s),e},x="focus-trap.focus-after-trapped",A="focus-trap.focus-after-released",k={cancelable:!0,bubbles:!1},S={cancelable:!0,bubbles:!1},I="focusAfterTrapped",N="focusAfterReleased",R=Symbol("elFocusTrap"),P=i(),F=i(0),K=i(0);let _=0;const C=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},B=(e,t)=>{for(const n of e)if(!O(n,t))return n},O=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1},j=(t,n)=>{if(t&&t.focus){const o=document.activeElement;let s=!1;!e(t)||T(t)||t.getAttribute("tabindex")||(t.setAttribute("tabindex","-1"),s=!0),t.focus({preventScroll:!0}),K.value=window.performance.now(),t!==o&&(e=>e instanceof HTMLInputElement&&"select"in e)(t)&&n&&t.select(),e(t)&&s&&t.removeAttribute("tabindex")}};function M(e,t){const n=[...e],o=e.indexOf(t);return-1!==o&&n.splice(o,1),n}const q=(()=>{let e=[];return{push:t=>{const n=e[0];n&&t!==n&&n.pause(),e=M(e,t),e.unshift(t)},remove:t=>{var n,o;e=M(e,t),null==(o=null==(n=e[0])?void 0:n.resume)||o.call(n)}}})(),U=()=>{P.value="pointer",F.value=window.performance.now()},$=()=>{P.value="keyboard",F.value=window.performance.now()},D=e=>new CustomEvent("focus-trap.focusout-prevented",{...S,detail:e});let H=[];const W=e=>{e.code===n.esc&&H.forEach((t=>t(e)))};var z=o(l({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[I,N,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:o}){const a=i();let r,u;const{focusReason:l}=(d((()=>{0===_&&(document.addEventListener("mousedown",U),document.addEventListener("touchstart",U),document.addEventListener("keydown",$)),_++})),c((()=>{_--,_<=0&&(document.removeEventListener("mousedown",U),document.removeEventListener("touchstart",U),document.removeEventListener("keydown",$))})),{focusReason:P,lastUserFocusTimestamp:F,lastAutomatedFocusTimestamp:K});var f;f=t=>{e.trapped&&!y.paused&&o("release-requested",t)},d((()=>{0===H.length&&document.addEventListener("keydown",W),t&&H.push(f)})),c((()=>{H=H.filter((e=>e!==f)),0===H.length&&t&&document.removeEventListener("keydown",W)}));const y={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},h=t=>{if(!e.loop&&!e.trapped)return;if(y.paused)return;const{code:s,altKey:a,ctrlKey:r,metaKey:u,currentTarget:d,shiftKey:c}=t,{loop:i}=e,f=s===n.tab&&!a&&!r&&!u,v=document.activeElement;if(f&&v){const e=d,[n,s]=(e=>{const t=C(e);return[B(t,e),B(t.reverse(),e)]})(e);if(n&&s)if(c||v!==s){if(c&&[n,e].includes(v)){const e=D({focusReason:l.value});o("focusout-prevented",e),e.defaultPrevented||(t.preventDefault(),i&&j(s,!0))}}else{const e=D({focusReason:l.value});o("focusout-prevented",e),e.defaultPrevented||(t.preventDefault(),i&&j(n,!0))}else if(v===e){const e=D({focusReason:l.value});o("focusout-prevented",e),e.defaultPrevented||t.preventDefault()}}};b(R,{focusTrapRef:a,onKeydown:h}),v((()=>e.focusTrapEl),(e=>{e&&(a.value=e)}),{immediate:!0}),v([a],(([e],[t])=>{e&&(e.addEventListener("keydown",h),e.addEventListener("focusin",T),e.addEventListener("focusout",g)),t&&(t.removeEventListener("keydown",h),t.removeEventListener("focusin",T),t.removeEventListener("focusout",g))}));const w=e=>{o(I,e)},L=e=>o(N,e),T=t=>{const n=p(a);if(!n)return;const s=t.target,d=t.relatedTarget,c=s&&n.contains(s);if(!e.trapped){d&&n.contains(d)||(r=d)}c&&o("focusin",t),y.paused||e.trapped&&(c?u=s:j(u,!0))},g=t=>{const n=p(a);if(!y.paused&&n)if(e.trapped){const a=t.relatedTarget;s(a)||n.contains(a)||setTimeout((()=>{if(!y.paused&&e.trapped){const e=D({focusReason:l.value});o("focusout-prevented",e),e.defaultPrevented||j(u,!0)}}),0)}else{const e=t.target;e&&n.contains(e)||o("focusout",t)}};async function S(){await m();const t=p(a);if(t){q.push(y);const n=t.contains(document.activeElement)?r:document.activeElement;r=n;if(!t.contains(n)){const o=new Event(x,k);t.addEventListener(x,w),t.dispatchEvent(o),o.defaultPrevented||m((()=>{let o=e.focusStartEl;E(o)||(j(o),document.activeElement!==o&&(o="first")),"first"===o&&((e,t=!1)=>{const n=document.activeElement;for(const o of e)if(j(o,t),document.activeElement!==n)return})(C(t),!0),document.activeElement!==n&&"container"!==o||j(t)}))}}}function O(){const e=p(a);if(e){e.removeEventListener(x,w);const t=new CustomEvent(A,{...k,detail:{focusReason:l.value}});e.addEventListener(A,L),e.dispatchEvent(t),t.defaultPrevented||"keyboard"!=l.value&&F.value>K.value&&!e.contains(document.activeElement)||j(null!=r?r:document.body),e.removeEventListener(A,L),q.remove(y)}}return d((()=>{e.trapped&&S(),v((()=>e.trapped),(e=>{e?S():O()}))})),c((()=>{e.trapped&&O(),a.value&&(a.value.removeEventListener("keydown",h),a.value.removeEventListener("focusin",T),a.value.removeEventListener("focusout",g),a.value=void 0)})),{onKeydown:h}}}),[["render",function(e,t,n,o,s,a){return f(e.$slots,"default",{handleKeydown:e.onKeydown})}],["__file","focus-trap.vue"]]);const X=u(o(l({__name:"teleport",props:a({to:{type:r([String,Object]),required:!0},disabled:Boolean}),setup:e=>(e,t)=>e.disabled?f(e.$slots,"default",{key:0}):(h(),y(w,{key:1,to:e.to},[f(e.$slots,"default")],8,["to"]))}),[["__file","teleport.vue"]]));export{z as E,X as a,j as b,T as i,L as o,g as t};
